{"version":3,"file":"ng-body-scroll-lock.js","sources":["ng://ng-body-scroll-lock/lib/ng-body-scroll-lock.service.ts","ng://ng-body-scroll-lock/lib/ng-body-scroll.lock.module.ts","ng://ng-body-scroll-lock/public-api.ts","ng://ng-body-scroll-lock/ng-body-scroll-lock.ts"],"sourcesContent":["import { Injectable, Renderer2 } from '@angular/core';\n\nexport interface BodyScrollOptions\n{\n    reserveScrollBarGap?: boolean;\n    allowTouchMove?: (el: any) => boolean;\n}\n\ninterface Lock\n{\n    targetElement: any;\n    options: BodyScrollOptions;\n}\n\ntype HandleScrollEvent = TouchEvent;\n\n@Injectable()\nexport class NgBodyScrollLockService\n{\n    private hasPassiveEvents = false;\n    private isIosDevice: boolean;\n    private initialClientY = -1;\n    private locks: Lock[] = [];\n    private documentListenerAdded = false;\n    private previousBodyPaddingRight: string;\n    private previousBodyOverflowSetting: string;\n\n    constructor(private renderer: Renderer2)\n    {\n        this.TestPassive();\n        this.CheckIfIsIosDevice();\n    }\n\n    public DisableBodyScroll(targetElement: any, options?: BodyScrollOptions): void {\n        // targetElement must be provided\n        if (!targetElement) {\n            // eslint-disable-next-line no-console\n            console.error('disableBodyScroll unsuccessful - targetElement must be provided when calling disableBodyScroll on IOS devices.');\n            return;\n        }\n\n        // disableBodyScroll must not have been called on this targetElement before\n        // tslint:disable-next-line:no-shadowed-variable\n        if (this.locks.some((lock: Lock) => lock.targetElement === targetElement)) {\n            return;\n        }\n\n        const lock =\n        {\n            targetElement,\n            options: options || {},\n        };\n\n        this.locks = [...this.locks, lock];\n\n        if (this.isIosDevice) {\n            targetElement.ontouchstart = (event: HandleScrollEvent) => {\n                if (event.targetTouches.length === 1) {\n                    // detect single touch.\n                    this.initialClientY = event.targetTouches[0].clientY;\n                }\n            };\n\n            targetElement.ontouchmove = (event: HandleScrollEvent) => {\n                if (event.targetTouches.length === 1) {\n                    // detect single touch.\n                    this.HandleScroll(event, targetElement);\n                }\n            };\n\n            if (!this.documentListenerAdded) {\n                document.addEventListener('touchmove', this.PreventDefault.bind(this),\n                    this.hasPassiveEvents ? { passive: false } : undefined);\n                this.documentListenerAdded = true;\n            }\n        } else {\n            this.SetOverflowHidden(options);\n        }\n    }\n\n    public ClearAllBodyScrollLocks(): void {\n        if (this.isIosDevice) {\n            // Clear all locks ontouchstart/ontouchmove handlers, and the references.\n            this.locks.forEach((lock: Lock) => {\n                lock.targetElement.ontouchstart = null;\n                lock.targetElement.ontouchmove = null;\n            });\n\n            if (this.documentListenerAdded) {\n                // Passive argument removed because EventListenerOptions doesn't contain passive property.\n                document.removeEventListener('touchmove', this.PreventDefault.bind(this));\n                this.documentListenerAdded = false;\n            }\n            // Reset initial clientY.\n            this.initialClientY = -1;\n        } else {\n            this.RestoreOverflowSetting();\n        }\n\n        this.locks = [];\n    }\n\n    public EnableBodyScroll(targetElement: any): void {\n        if (!targetElement) {\n            // eslint-disable-next-line no-console\n            console.error('enableBodyScroll unsuccessful - targetElement must be provided when calling enableBodyScroll on IOS devices.');\n            return;\n        }\n\n        this.locks = this.locks.filter(lock => lock.targetElement !== targetElement);\n\n        if (this.isIosDevice) {\n            targetElement.ontouchstart = null;\n            targetElement.ontouchmove = null;\n\n            if (this.documentListenerAdded && this.locks.length === 0) {\n                document.removeEventListener('touchmove', this.PreventDefault.bind(this));\n                this.documentListenerAdded = false;\n            }\n        } else if (!this.locks.length) {\n            this.RestoreOverflowSetting();\n        }\n    }\n\n    private RestoreOverflowSetting(): void {\n        if (this.previousBodyPaddingRight !== undefined) {\n            this.renderer.setStyle(document.body, 'padding-right', this.previousBodyPaddingRight);\n\n            // Restore previousBodyPaddingRight to undefined so setOverflowHidden knows it\n            // can be set again.\n            this.previousBodyPaddingRight = undefined;\n        }\n\n        if (this.previousBodyOverflowSetting !== undefined) {\n            this.renderer.setStyle(document.body, 'overflow', this.previousBodyOverflowSetting);\n\n            // Restore previousBodyOverflowSetting to undefined\n            // so setOverflowHidden knows it can be set again.\n            this.previousBodyOverflowSetting = undefined;\n        }\n    }\n\n    private SetOverflowHidden(options?: BodyScrollOptions): void {\n        // If previousBodyPaddingRight is already set, don't set it again.\n        if (this.previousBodyPaddingRight === undefined) {\n            const reserveScrollBarGap = !!options && options.reserveScrollBarGap === true;\n            const scrollBarGap = window.innerWidth - document.documentElement.clientWidth;\n\n            if (reserveScrollBarGap && scrollBarGap > 0) {\n                this.previousBodyPaddingRight = document.body.style.paddingRight;\n                this.renderer.setStyle(document.body, 'padding-right', `${scrollBarGap}px`);\n            }\n        }\n        // If previousBodyOverflowSetting is already set, don't set it again.\n        if (this.previousBodyOverflowSetting === undefined) {\n            this.previousBodyOverflowSetting = document.body.style.overflow;\n            this.renderer.setStyle(document.body, 'overflow', 'hidden');\n        }\n    }\n\n    private PreventDefault(rawEvent: HandleScrollEvent): boolean {\n        const e = rawEvent || window.event;\n\n        // For the case whereby consumers adds a touchmove event listener to document.\n        // Recall that we do document.addEventListener('touchmove', preventDefault, { passive: false })\n        // in disableBodyScroll - so if we provide this opportunity to allowTouchMove, then\n        // the touchmove event on document will break.\n        if (this.AllowTouchMove(e.target)) {\n            return true;\n        }\n        // Do not prevent if the event has more than one touch (usually meaning this is a multi touch gesture like pinch to zoom).\n        // @ts-ignore\n        if (e.touches.length > 1) { return true; }\n\n        if (e.preventDefault) { e.preventDefault(); }\n\n        return false;\n    }\n\n    private HandleScroll(event: HandleScrollEvent, targetElement: any): any\n    {\n        const clientY = event.targetTouches[0].clientY - this.initialClientY;\n\n        if (this.AllowTouchMove(event.target)) {\n            return false;\n        }\n\n        if (targetElement && targetElement.scrollTop === 0 && clientY > 0) {\n            // element is at the top of its scroll.\n            return this.PreventDefault(event);\n        }\n\n        if (this.isTargetElementTotallyScrolled(targetElement) && clientY < 0) {\n            // element is at the bottom of its scroll.\n            return this.PreventDefault(event);\n        }\n\n        event.stopPropagation();\n        return true;\n    }\n\n    private isTargetElementTotallyScrolled(targetElement: any): boolean {\n        return targetElement ? targetElement.scrollHeight - targetElement.scrollTop <= targetElement.clientHeight : false;\n    }\n    private AllowTouchMove(el: EventTarget): boolean {\n        return this.locks.some(lock => {\n            return lock.options.allowTouchMove && lock.options.allowTouchMove(el);\n        });\n    }\n\n    private CheckIfIsIosDevice(): void\n    {\n        this.isIosDevice = typeof window !== 'undefined' &&\n            window.navigator &&\n            window.navigator.platform &&\n            (/iP(ad|hone|od)/.test(window.navigator.platform) ||\n                (window.navigator.platform === 'MacIntel' && window.navigator.maxTouchPoints > 1));\n    }\n\n    private TestPassive(): void\n    {\n        if (typeof window !== 'undefined')\n        {\n            const passiveTestOptions =\n            {\n                get passive()\n                {\n                    this.hasPassiveEvents = true;\n                    return undefined;\n                }\n            };\n            window.addEventListener('testPassive', null, passiveTestOptions);\n            // @ts-ignore\n            window.removeEventListener('testPassive', null, passiveTestOptions);\n        }\n    }\n}\n","import { NgModule } from '@angular/core';\r\nimport { NgBodyScrollLockService } from './ng-body-scroll-lock.service';\r\n\r\n@NgModule({\r\n    providers: [NgBodyScrollLockService]\r\n})\r\nexport class NgBodyScrollLockModule {}\r\n","/*\n * Public API Surface of ng-body-scroll-lock\n */\n\nexport * from './lib/ng-body-scroll-lock.service';\nexport * from './lib/ng-body-scroll.lock.module';\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n"],"names":[],"mappings":"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"}